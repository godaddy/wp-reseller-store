!function(d){"use strict";var i={init:function(){var t;window.self===window.top&&(t=window.addEventListener?"addEventListener":"attachEvent",(0,window[t])("attachEvent"===t?"onmessage":"message",function(t){t.data&&("link"===t.data.message&&i.validateSecret(t.data.secret)&&(window.location=t.data.value),"addItemSuccess"===t.data.message&&i.validateSecret(t.data.secret)&&i.updateCount(t.data.value))},!1))},validateSecret:function(a){return d("iframe.wp-embedded-content").filter(function(t,e){return d(e).data("secret")===a}).length},addItemApi:function(t,e,a,r){var o="&cart="+JSON.stringify(t);e&&(o+="&isc="+e);var n={type:"GET",url:rstore.urls.cart_api+o,dataType:"jsonp"};a=d.isFunction(a)?a:function(){},r=d.isFunction(r)?r:function(){},d.ajax(n).done(a).fail(r)},addItem:function(t,e,a,r,o){var n={items:[{id:t,quantity:0<e?e:1}]};i.addItemApi(n,r,function(t){if(t.error)return i.addItemError(o,t);if(i.updateCount(t),t.nextStepUrl){if(a)return void(window.location.href=t.nextStepUrl);o.find(".rstore-cart").find("a").attr("href",t.nextStepUrl)}i.addItemSuccess(o)},function(t){o&&i.addItemError(o,t)})},updateCount:function(t){var e;window.self!==window.top?(e=window.location.hash.replace(/.*secret=([\d\w]{10}).*/,"$1"),window.parent.postMessage({message:"addItemSuccess",value:t,secret:e},"*")):(t=(t=void 0!==t.cartCount?t.cartCount:t)?parseInt(t,10):0,d(".rstore-cart-count").text(t),d(".widget.rstore-cart").each(function(){d(this).toggle(!d(this).hasClass("hide-empty")||0<t)}))},addItemButton:function(t){var e=d(this),a=e.closest(".rstore-add-to-cart-form"),r=e.attr("data-id"),o=parseInt(e.attr("data-quantity"),10),n="true"===e.attr("data-redirect"),s=e.attr("data-isc");if(t.preventDefault(),e.attr("data-loading"))return!1;e.attr("data-loading","true"),a.find(".rstore-message").empty(),a.find(".rstore-loading").removeClass("rstore-loading-hidden"),i.addItem(r,o,n,s,a)},addItemSuccess:function(t){t.find(".rstore-add-to-cart").removeAttr("data-loading"),t.find(".rstore-loading").addClass("rstore-loading-hidden"),t.find(".rstore-cart").removeClass("rstore-cart-hidden")},addItemError:function(t,e){var a,r,o;a=e.error,r=rstore.i18n.error,void 0!==a.message&&(r=a.message),o='<span class="dashicons dashicons-warning rstore-error"></span> '+r,t.find(".rstore-add-to-cart").removeAttr("data-loading"),t.find(".rstore-loading").addClass("rstore-loading-hidden"),t.find(".rstore-message").html(o).removeClass("rstore-message-hidden")},addItemParam:function(){var t=window.location.search.match(/(\?|&)add-to-cart=(.*?)(&|$)/i);null!==t&&rstore.product.id&&(i.addItem(rstore.product.id,parseInt(t[2],10),!1),window.history.replaceState({},"",window.location.href.split("?")[0]))}},t=function(){var t,e,a;window.self===window.top&&(t=rstore.pl_id,e=Cookies.get(rstore.cookies.shopperId),a=rstore.urls.gui,d.ajax({url:a,jsonp:"callback",dataType:"jsonp",data:{plid:t,sid:e},success:function(t){"partial"===t.status&&(d(".rstore-welcome-block span.firstname").each(function(){d(this).text(t.name)}),d(".rstore-welcome-block span.lastname").each(function(){d(this).text(t.lastname)}),d(".rstore-welcome-block span.shopper-id").each(function(){d(this).text(t.shopperid)}),d(".rstore-welcome-block").each(function(){d(this).show()}),d(".rstore-login-block").each(function(){d(this).hide()})),d(".rstore-support-block").each(function(){d(".rstore-support-block").html('<a href="tel:'+t.supportphone.number+'" class="support-link" ><span class="number">'+t.supportphone.number+"</span></a>")}),i.updateCount(t.carttotal)}}))},a={placeholder:null,init:function(){d(".rstore-domain-popup").length&&(d("body").append(d("<div></div>").attr("id","rstore-popResults").addClass("")),d("body").append(d("<div></div>").attr("id","rstore-blackout").addClass("")),d("#rstore-popResults").append(d("<div></div>").attr("id","rstore-closePop").addClass("").html("X")),d(".rstore-domain-search").on("click",".rstore-domain-search-button",a.showModal),d("body").on("click","#rstore-closePop, #rstore-blackout",function(){d("#rstore-popResults").fadeOut(),d("#rstore-blackout").fadeOut(),d("#rstore-popResults").find(".result-content").hide(),a.placeholder&&(a.placeholder.append(d(".rstore-domain-popup")),a.placeholder=null)}),/[?&]domainToCheck=./.test(window.location.search)&&a.showModal({target:d(".rstore-domain-popup").first().find(".rstore-domain-search-button")[0]}))},showModal:function(t){var e=d(t.target.form.parentElement);e.hasClass("rstore-domain-popup")&&(d("#rstore-blackout").fadeIn(),d("#rstore-popResults").fadeIn(),e.find(".result-content").fadeIn(),e.parent().hasClass("rstore_domain_placeholder")&&(a.placeholder=e.parent()),d("#rstore-popResults").append(e))}};d(document).ready(function(){i.addItemParam(),i.init(),t(),a.init(),d(".rstore-add-to-cart").on("click",i.addItemButton)})}(jQuery);