!function(s){"use strict";var d={init:function(){var t;window.self===window.top&&(t=window.addEventListener?"addEventListener":"attachEvent",(0,window[t])("attachEvent"===t?"onmessage":"message",function(t){t.data&&("link"===t.data.message&&d.validateSecret(t.data.secret)&&(window.location=t.data.value),"addItemSuccess"===t.data.message&&d.validateSecret(t.data.secret)&&d.updateCount(t.data.value))},!1))},validateSecret:function(a){return s("iframe.wp-embedded-content").filter(function(t,e){return s(e).data("secret")===a}).length},addItemApi:function(t,e,a){var r="&cart="+JSON.stringify(t),o={type:"GET",url:rstore.urls.cart_api+r,dataType:"jsonp"};e=s.isFunction(e)?e:function(){},a=s.isFunction(a)?a:function(){},s.ajax(o).done(e).fail(a)},addItem:function(t,e,a,r){var o={items:[{id:t,quantity:0<e?e:1}]};d.addItemApi(o,function(t){if(t.error)return d.addItemError(r,t);if(d.updateCount(t),t.nextStepUrl){if(a)return void(window.location.href=t.nextStepUrl);r.find(".rstore-cart").find("a").attr("href",t.nextStepUrl)}d.addItemSuccess(r)},function(t){window.console.log(t),r&&d.addItemError(r,t)})},updateCount:function(t){var e;window.self!==window.top?(e=window.location.hash.replace(/.*secret=([\d\w]{10}).*/,"$1"),window.parent.postMessage({message:"addItemSuccess",value:t,secret:e},"*")):(t=(t=void 0!==t.cartCount?t.cartCount:t)?parseInt(t,10):0,s(".rstore-cart-count").text(t),s(".widget.rstore-cart").each(function(){s(this).toggle(!s(this).hasClass("hide-empty")||0<t)}))},addItemButton:function(t){var e=s(this),a=e.closest(".rstore-add-to-cart-form"),r=e.attr("data-id"),o=parseInt(e.attr("data-quantity"),10),n="true"===e.attr("data-redirect");if(t.preventDefault(),e.attr("data-loading"))return!1;e.attr("data-loading","true"),a.find(".rstore-message").empty(),a.find(".rstore-loading").removeClass("rstore-loading-hidden"),d.addItem(r,o,n,a)},addItemSuccess:function(t){t.find(".rstore-add-to-cart").removeAttr("data-loading"),t.find(".rstore-loading").addClass("rstore-loading-hidden"),t.find(".rstore-cart").removeClass("rstore-cart-hidden")},addItemError:function(t,e){var a,r,o;a=e.error,r=rstore.i18n.error,void 0!==a.message&&(r=a.message),o='<span class="dashicons dashicons-warning rstore-error"></span> '+r,t.find(".rstore-add-to-cart").removeAttr("data-loading"),t.find(".rstore-loading").addClass("rstore-loading-hidden"),t.find(".rstore-message").html(o)},addItemParam:function(){var t=window.location.search.match(/(\?|&)add-to-cart=(.*?)(&|$)/i);null!==t&&rstore.product.id&&(d.addItem(rstore.product.id,parseInt(t[2],10),!1),window.history.replaceState({},"",window.location.href.split("?")[0]))}},e=function(){var t,e,a;window.self===window.top&&(t=rstore.pl_id,e=Cookies.get(rstore.cookies.shopperId),a=rstore.urls.gui,s.ajax({url:a,jsonp:"callback",dataType:"jsonp",data:{plid:t,sid:e},success:function(t){"partial"===t.status&&(s(".rstore-welcome-block span.firstname").each(function(){s(this).text(t.name)}),s(".rstore-welcome-block span.lastname").each(function(){s(this).text(t.lastname)}),s(".rstore-welcome-block span.shopper-id").each(function(){s(this).text(t.shopperid)}),s(".rstore-welcome-block").each(function(){s(this).show()}),s(".rstore-login-block").each(function(){s(this).hide()})),s(".rstore-support-block").each(function(){s(".rstore-support-block").html('<a href="tel:'+t.supportphone.number+'" class="support-link" ><span class="number">'+t.supportphone.number+"</span></a>")}),d.updateCount(t.carttotal)}}))},a={placeholder:null,init:function(){s(".rstore-domain-popup").length&&(s("body").append(s("<div></div>").attr("id","rstore-popResults").addClass("")),s("body").append(s("<div></div>").attr("id","rstore-blackout").addClass("")),s("#rstore-popResults").append(s("<div></div>").attr("id","rstore-closePop").addClass("").html("X")),s(".rstore-domain-search").on("click",".rstore-domain-search-button",a.showModal),s("body").on("click","#rstore-closePop, #rstore-blackout",function(){s("#rstore-popResults").fadeOut(),s("#rstore-blackout").fadeOut(),s("#rstore-popResults").find(".result-content").hide(),a.placeholder&&(a.placeholder.append(s(".rstore-domain-popup")),a.placeholder=null)}),/[?&]domainToCheck=./.test(location.search)&&a.showModal({target:s(".rstore-domain-popup").first().find(".rstore-domain-search-button")[0]}))},showModal:function(t){var e=s(t.target.form.parentElement);e.hasClass("rstore-domain-popup")&&(s("#rstore-blackout").fadeIn(),s("#rstore-popResults").fadeIn(),e.find(".result-content").fadeIn(),e.parent().hasClass("rstore_domain_placeholder")&&(a.placeholder=e.parent()),s("#rstore-popResults").append(e))}};s(document).ready(function(t){d.addItemParam(),d.init(),e(),a.init(),t(".rstore-add-to-cart").on("click",d.addItemButton)})}(jQuery);