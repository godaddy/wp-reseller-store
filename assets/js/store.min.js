!function(n){"use strict";var s={init:function(){var t;window.self===window.top&&(t=window.addEventListener?"addEventListener":"attachEvent",(0,window[t])("attachEvent"==t?"onmessage":"message",function(t){t.data&&("link"===t.data.message&&s.validateSecret(t.data.secret)&&(window.location=t.data.value),"addItemSuccess"===t.data.message&&s.validateSecret(t.data.secret)&&s.updateCount(t.data.value))},!1))},validateSecret:function(a){return n("iframe.wp-embedded-content").filter(function(t,e){return n(e).data("secret")===a}).length},addItemApi:function(t,e,a){var r="&cart="+JSON.stringify(t),o={type:"GET",url:rstore.urls.cart_api+r,dataType:"jsonp"};e=n.isFunction(e)?e:function(){},a=n.isFunction(a)?a:function(){},n.ajax(o).done(e).fail(a)},addItem:function(t,e,a){var r={items:[{id:t,quantity:0<e?e:1}]};s.addItemApi(r,function(t){if(t.error)return s.addItemError(a,t);s.updateCount(t),t.nextStepUrl&&a.find(".rstore-cart").find("a").attr("href",t.nextStepUrl),s.addItemSuccess(a)},function(t){a&&s.addItemError(a,t)})},updateCount:function(t){var e;window.self!==window.top?(e=window.location.hash.replace(/.*secret=([\d\w]{10}).*/,"$1"),window.parent.postMessage({message:"addItemSuccess",value:t,secret:e},"*")):(t=(t=void 0!==t.cartCount?t.cartCount:t)?parseInt(t,10):0,n(".rstore-cart-count").text(t),n(".widget.rstore-cart").each(function(){n(this).toggle(!n(this).hasClass("hide-empty")||0<t)}))},addItemButton:function(t){var e=n(this),a=e.closest(".rstore-add-to-cart-form"),r=e.attr("data-id"),o=parseInt(e.attr("data-quantity"),10);if(e.attr("data-loading"))return!1;e.attr("data-loading","true"),a.find(".rstore-message").empty(),a.find(".rstore-loading").removeClass("rstore-loading-hidden"),r&&(t.preventDefault(),s.addItem(r,o,a))},addItemSuccess:function(t){t.find(".rstore-add-to-cart").removeAttr("data-loading"),t.find(".rstore-loading").addClass("rstore-loading-hidden"),t.find(".rstore-cart").removeClass("rstore-cart-hidden")},addItemError:function(t,e){var a,r,o;a=e.error,r=rstore.i18n.error,void 0!==a.message&&(r=a.message),o='<span class="dashicons dashicons-warning rstore-error"></span> '+r,t.find(".rstore-add-to-cart").removeAttr("data-loading"),t.find(".rstore-loading").addClass("rstore-loading-hidden"),t.find(".rstore-message").html(o).removeClass("rstore-message-hidden")},addItemParam:function(){var t=window.location.search.match(/(\?|&)add-to-cart=(.*?)(&|$)/i);null!==t&&rstore.product.id&&(s.addItem(rstore.product.id,parseInt(t[2],10),!1),window.history.replaceState({},"",window.location.href.split("?")[0]))}},t=function(){var t,e,a;window.self===window.top&&(t=rstore.pl_id,e=Cookies.get(rstore.cookies.shopperId),a=rstore.urls.gui,n.ajax({url:a,jsonp:"callback",dataType:"jsonp",data:{plid:t,sid:e},success:function(t){"partial"===t.status&&(n(".rstore-welcome-block span.firstname").each(function(){n(this).text(t.name)}),n(".rstore-welcome-block span.lastname").each(function(){n(this).text(t.lastname)}),n(".rstore-welcome-block span.shopper-id").each(function(){n(this).text(t.shopperid)}),n(".rstore-welcome-block").each(function(){n(this).show()}),n(".rstore-login-block").each(function(){n(this).hide()})),n(".rstore-support-block").each(function(){n(".rstore-support-block").html('<a href="tel:'+t.supportphone.number+'" class="support-link" ><span class="number">'+t.supportphone.number+"</span></a>")}),s.updateCount(t.carttotal)}}))},a={placeholder:null,init:function(){n(".rstore-domain-popup").length&&(n("body").append(n("<div></div>").attr("id","rstore-popResults").addClass("")),n("body").append(n("<div></div>").attr("id","rstore-blackout").addClass("")),n("#rstore-popResults").append(n("<div></div>").attr("id","rstore-closePop").addClass("").html("X")),n(".rstore-domain-search").on("click",".rstore-domain-search-button",a.showModal),n("body").on("click","#rstore-closePop, #rstore-blackout",function(){n("#rstore-popResults").fadeOut(),n("#rstore-blackout").fadeOut(),n("#rstore-popResults").find(".result-content").hide(),a.placeholder&&(a.placeholder.append(n(".rstore-domain-popup")),a.placeholder=null)}),/[?&]domainToCheck=./.test(window.location.search)&&a.showModal({target:n(".rstore-domain-popup").first().find(".rstore-domain-search-button")[0]}))},showModal:function(t){var e=n(t.target.form.parentElement.parentElement);e.hasClass("rstore-domain-popup")&&(n("#rstore-blackout").fadeIn(),n("#rstore-popResults").fadeIn(),e.find(".result-content").fadeIn(),e.parent().hasClass("rstore_domain_placeholder")&&(a.placeholder=e.parent()),n("#rstore-popResults").append(e))}};n(document).ready(function(){s.addItemParam(),s.init(),t(),a.init(),n(".rstore-add-to-cart").on("click",s.addItemButton)})}(jQuery);