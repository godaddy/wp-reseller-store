!function(a){"use strict";var b={init:function(){if(window.self===window.top){var a=parseInt(Cookies.get(rstore.cookies.cartCount),10);b.updateCount(a),a>0&&b.api("get",{},function(a){b.updateCount(a)});var c=window.addEventListener?"addEventListener":"attachEvent",d=window[c],e="attachEvent"==c?"onmessage":"message";d(e,function(a){a.data&&("link"===a.data.message&&b.validateSecret(a.data.secret)&&(window.location=a.data.value),"addItemSuccess"===a.data.message&&b.validateSecret(a.data.secret)&&b.updateCount(a.data.value))},!1)}},validateSecret:function(b){return a("iframe.wp-embedded-content").filter(function(c,d){return a(d).data("secret")===b}).length},api:function(b,c,d,e){var f={method:b,url:rstore.urls.cart_api,dataType:"json",contentType:"application/json",data:JSON.stringify(c),crossDomain:!0,xhrFields:{withCredentials:!0}};d=a.isFunction(d)?d:function(){},e=a.isFunction(e)?e:function(){},a.ajax(f).done(d).fail(e)},addItem:function(a,c,d,e){var f={items:[{id:a,quantity:c>0?c:1}]};b.api("post",f,function(a){b.updateCount(a),d&&(window.location.href=rstore.urls.cart),e&&!d&&b.addItemSuccess(e)},function(a){window.console.log(a),e&&b.addItemError(e,a)})},updateCount:function(b){if(window.self!==window.top){var c=window.location.hash.replace(/.*secret=([\d\w]{10}).*/,"$1");window.parent.postMessage({message:"addItemSuccess",value:b,secret:c},"*")}else b=void 0!==b.cartCount?b.cartCount:b,b=b?parseInt(b,10):0,Cookies.set(rstore.cookies.cartCount,b,{expires:new Date((new Date).getTime()+rstore.cookies.ttl),path:"/"}),a(".rstore-cart-count").text(b),a(".widget.rstore-cart").each(function(){a(this).toggle(!a(this).hasClass("hide-empty")||b>0)})},addItemButton:function(c){c.preventDefault();var d=a(this),e=d.closest(".rstore-add-to-cart-form"),f=d.attr("data-id"),g=parseInt(d.attr("data-quantity"),1),h="true"===d.attr("data-redirect");return!d.attr("data-loading")&&(d.attr("data-loading","true"),e.find(".rstore-message").empty(),e.find(".rstore-loading").removeClass("rstore-loading-hidden"),void b.addItem(f,g,h,e))},addItemSuccess:function(a){var b='<span class="dashicons dashicons-yes rstore-success"></span> <a href="'+rstore.urls.cart+'" >'+rstore.i18n.view_cart+"</a>";a.find(".rstore-add-to-cart").removeAttr("data-loading"),a.find(".rstore-loading").addClass("rstore-loading-hidden"),a.find(".rstore-message").html(b)},addItemError:function(a,b){var c=b.responseJSON.error,d=rstore.i18n.error;void 0!==c.message&&(d=c.message);var e='<span class="dashicons dashicons-warning rstore-error"></span> '+d;a.find(".rstore-add-to-cart").removeAttr("data-loading"),a.find(".rstore-loading").addClass("rstore-loading-hidden"),a.find(".rstore-message").html(e)},addItemParam:function(){var a=window.location.search.match(/(\?|&)add-to-cart=(.*?)(&|$)/i);null!==a&&rstore.product.id&&(b.addItem(rstore.product.id,parseInt(a[2],10),!1),window.history.replaceState({},"",window.location.href.split("?")[0]))}};a(document).ready(function(a){b.addItemParam(),b.init(),a(".rstore-add-to-cart").on("click",b.addItemButton)})}(jQuery);