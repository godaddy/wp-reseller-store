!function(t){"use strict";var e={init:function(){var t;window.self===window.top&&(t=window.addEventListener?"addEventListener":"attachEvent",(0,window[t])("attachEvent"===t?"onmessage":"message",function(t){t.data&&("link"===t.data.message&&e.validateSecret(t.data.secret)&&(window.location=t.data.value),"addItemSuccess"===t.data.message&&e.validateSecret(t.data.secret)&&e.updateCount(t.data.value))},!1))},validateSecret:function(e){return t("iframe.wp-embedded-content").filter(function(a,r){return t(r).data("secret")===e}).length},addItemApi:function(e,a,r){var o="&cart="+JSON.stringify(e),n={type:"GET",url:rstore.urls.cart_api+o,dataType:"jsonp"};a=t.isFunction(a)?a:function(){},r=t.isFunction(r)?r:function(){},t.ajax(n).done(a).fail(r)},addItem:function(t,a,r,o){var n={items:[{id:t,quantity:a>0?a:1}]};e.addItemApi(n,function(t){if(t.error)return e.addItemError(o,t);e.updateCount(t),r?window.location.href=o.find(".rstore-cart").find("a").attr("href"):e.addItemSuccess(o)},function(t){window.console.log(t),o&&e.addItemError(o,t)})},updateCount:function(e){var a;window.self!==window.top?(a=window.location.hash.replace(/.*secret=([\d\w]{10}).*/,"$1"),window.parent.postMessage({message:"addItemSuccess",value:e,secret:a},"*")):(e=void 0!==e.cartCount?e.cartCount:e,e=e?parseInt(e,10):0,t(".rstore-cart-count").text(e),t(".widget.rstore-cart").each(function(){t(this).toggle(!t(this).hasClass("hide-empty")||e>0)}))},addItemButton:function(a){var r=t(this),o=r.closest(".rstore-add-to-cart-form"),n=r.attr("data-id"),d=parseInt(r.attr("data-quantity"),10),i="true"===r.attr("data-redirect");if(a.preventDefault(),r.attr("data-loading"))return!1;r.attr("data-loading","true"),o.find(".rstore-message").empty(),o.find(".rstore-loading").removeClass("rstore-loading-hidden"),e.addItem(n,d,i,o)},addItemSuccess:function(t){t.find(".rstore-add-to-cart").removeAttr("data-loading"),t.find(".rstore-loading").addClass("rstore-loading-hidden"),t.find(".rstore-cart").removeClass("rstore-cart-hidden")},addItemError:function(t,e){var a,r,o;a=e.error,r=rstore.i18n.error,void 0!==a.message&&(r=a.message),o='<span class="dashicons dashicons-warning rstore-error"></span> '+r,t.find(".rstore-add-to-cart").removeAttr("data-loading"),t.find(".rstore-loading").addClass("rstore-loading-hidden"),t.find(".rstore-message").html(o)},addItemParam:function(){var t=window.location.search.match(/(\?|&)add-to-cart=(.*?)(&|$)/i);null!==t&&rstore.product.id&&(e.addItem(rstore.product.id,parseInt(t[2],10),!1),window.history.replaceState({},"",window.location.href.split("?")[0]))}},a={init:function(){var a,r,o;window.self===window.top&&(a=rstore.pl_id,r=Cookies.get(rstore.cookies.shopperId),o=rstore.urls.gui,t.ajax({url:o,jsonp:"callback",dataType:"jsonp",data:{plid:a,sid:r},success:function(a){"partial"===a.status&&(t(".rstore-welcome-block span.firstname").each(function(){t(this).text(a.name)}),t(".rstore-welcome-block span.lastname").each(function(){t(this).text(a.lastname)}),t(".rstore-welcome-block").each(function(){t(this).show()}),t(".rstore-login-block").each(function(){t(this).hide()})),e.updateCount(a.carttotal)}}))}};t(document).ready(function(t){e.addItemParam(),e.init(),a.init(),t(".rstore-add-to-cart").on("click",e.addItemButton)})}(jQuery);